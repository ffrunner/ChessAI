from flaosk import Flask, request, jsonify
from flask_cors import CORS
import chess
import chess.engine
from chess_engine import get_ai_move


app = Flask(__name__)
CORS(app)

board = chess.Board()

@app.route('/new-game', methods=['POST'])
def new_game():
    global board
    board = chess.Board()
    return jsonify({'fen': board.fen()})

@app.route('/player-move', methods=['POST'])
def player_move():
    global board
    data = request.json
    move_uci = data["move"]

    try:
        board.push_uci(move_uci)
    except:
        return jsonify({"error": "Invalid move"}), 400

    return jsonify({"fen": board.fen(), "game_over": board.is_game_over()})

@app.route("/ai-move", methods=["GET"])
def ai_move():
    global board
    move = get_ai_move(board)
    board.push(move)
    return jsonify({"move": move.uci(), "fen": board.fen(), "game_over": board.is_game_over()})

if __name__ == "__main__":
    app.run(debug=True)